"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var HappyMeals=function(){function a(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];_classCallCheck(this,a),this.days=7,this.nameDays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.reco=e,this.pattern=t,this.uptake=i,this.totalsWeek={},this.cumulativeState={},this.weekMap=this.weekMap()}return _createClass(a,[{key:"provideMeals",value:function(){for(var e in this.weekMap)for(var t=0;t<this.pattern.length;t++)void 0===this.weekMap[e][t]&&this.createMeal(e,this.pattern[t],t)}},{key:"createMeal",value:function(i,e,t){for(var a=this,n=e.portions,r=0,o=[],s=function(){var t=a.randomEntry(a.reco);if(a.checkMax(t,i,o)&&a.checkCumul(t,i,o)){var e=o.findIndex(function(e){return e.id==t.id});0<=e?o[e].portions=o[e].portions+1:o.push({id:t.id,name:t.name,portions:1,cumulative:t.cumulative}),r++}};r<n;)s();this.weekMap[i][t]=o,this.incrementTotals(i,o)}},{key:"checkCumul",value:function(t,e,i){return!!t.cumulative||!this.cumulativeState[e]&&void 0===i.find(function(e){return e.cumulative==t.cumulative})}},{key:"checkMax",value:function(t,e,i){var a=this.reco.find(function(e){return e.id==t.id}).max;if(void 0===a)return!0;if(void 0!==i.find(function(e){return e.id==t.id})&&!(a-=i.find(function(e){return e.id==t.id}).portions))return!1;var n=this.reco.find(function(e){return e.id==t.id}).period,r=void 0;return"day"==n&&void 0!==this.totalsWeek[t.id]&&void 0!==this.totalsWeek[t.id][e]&&(r=this.totalsWeek[t.id][e]),"week"==n&&void 0!==this.totalsWeek[t.id]&&void 0!==this.totalsWeek[t.id].week&&(r=this.totalsWeek[t.id].week),void 0===r&&(r=0),r<a}},{key:"incrementTotals",value:function(e,i){for(var a=this,t=function(t){void 0===a.totalsWeek[i[t].id]&&(a.totalsWeek[i[t].id]={}),void 0===a.totalsWeek[i[t].id][e]&&(a.totalsWeek[i[t].id][e]=0),a.totalsWeek[i[t].id][e]=a.totalsWeek[i[t].id][e]+i[t].portions,void 0===a.totalsWeek[i[t].id].week&&(a.totalsWeek[i[t].id].week=0),a.totalsWeek[i[t].id].week=a.totalsWeek[i[t].id].week+i[t].portions,void 0!==a.cumulativeState[e]||a.reco.find(function(e){return e.id==i[t].id}).cumulative||(a.cumulativeState[e]=i[t].name)},n=0;n<i.length;n++)t(n)}},{key:"randomEntry",value:function(e){if("Array"===e.constructor.name)return e[Math.floor(Math.random()*e.length)];if("Object"===e.constructor.name){var t=Object.keys(e);return e[t[Math.floor(Math.random()*t.length)]]}}},{key:"weekMap",value:function(){for(var e={},t=0;t<7;t++){var i=this.nameDays[t];if(e[i]={},void 0!==this.uptake[i])for(var a in this.uptake[i])e[i][a]=this.uptake[i][a],this.incrementTotals(i,this.uptake[i][a])}return e}},{key:"debug",value:function(){for(var e in this.weekMap);}}]),a}();